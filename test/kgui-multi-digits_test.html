<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>kgui-multi-digits test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../kgui-multi-digits.html">
  </head>
  <body>
    <test-fixture id="basic">
      <template>
        <kgui-multi-digits></kgui-multi-digits>
      </template>
    </test-fixture>

    <script>
      /* global
          suite, setup, fixture, test, assert
       */

      suite('kgui-multi-digits', function() {
        var decimalSeparator = (1.1).toLocaleString().replace(/1/g, '');
        var element;

        /**
         * To fire a CLICK event on those ADD, SUBTRACT buttons.
         * @param {Element} el element object to dispatch the EVENT `type` on.
         * @param {String} eType stands for EventType
        function eventFire(el, eType) {
          if (el.fireEvent) {
            el.fireEvent('on' + eType);
          } else {
            var evObj = document.createEvent('Events');
            evObj.initEvent(eType, true, false);
            el.dispatchEvent(evObj);
          }
        }
         */

        // -----------------------------------------------------------------------------------
        // Test preparation
        // -----------------------------------------------------------------------------------

        // Will be executed at the beginning of every test().
        setup(function() {
            element = fixture('basic');
        });

        // -----------------------------------------------------------------------------------
        // Elementary
        // -----------------------------------------------------------------------------------

        test('A01 - Instantiating the default element works', function() {
          assert.equal(element.is, 'kgui-multi-digits');
        });

        test('A02 - Default FORMAT `(#,##)#.#`', function() {
          assert.equal(element.format, '(#,##)#.#');
        });

        test('A03 - Default value 0', function() {
          assert.equal(element.number, 0);
        });

        // -----------------------------------------------------------------------------------
        // Function validateFormat()
        // -----------------------------------------------------------------------------------

        // Writing and testing https://regex101.com/
        test('B01 - validateFormat()', function() {
          // default situation
          assert.equal(element.format, '(#,##)#.#');

          // Some acceptable formats
          assert.equal(element.validateFormat('#'), true); // Just one digit
          assert.equal(element.validateFormat('#,#'), true); // Two digits diveded by a ','
          assert.equal(element.validateFormat('#.#'), true); // Two digits diveded by a ','
          assert.equal(element.validateFormat('##.#'), true); // 00,0
          assert.equal(element.validateFormat('(#)#.#'), true); // (0)0,0
          assert.equal(element.validateFormat('#,###.##'), true); // (0.0.)0.0
          assert.equal(element.validateFormat('(#.#).#.#'), true); // (0.0.)0.0

          // Some unacceptable formats
          assert.equal(element.validateFormat('a'), false); // 'Always start with '#' OR '(#' and always end with an '#'
          assert.equal(element.validateFormat('#(#)'), false); // 'Always start with '#' OR '(#' and always end with an '#'
          assert.equal(element.validateFormat('(#a)#'), false); // 'Allowed characters `.,#()`
          assert.equal(element.validateFormat('(#'), false); // 'Missing end ')'
          assert.equal(element.validateFormat('(#))#'), false); // 'No matching '()'
          assert.equal(element.validateFormat('#)#'), false); // 'No matching '()'
          assert.equal(element.validateFormat('(#(#))#'), false); // 'No matching '()'
          assert.equal(element.validateFormat('(#(#)#'), false); // 'No matching '()'
        });

        test('B02 - validateNumber()', function() {
          // default situation
          assert.equal(element.number, 0);

          // Some acceptable numbers
          assert.equal(element.validateNumber(1), true, '1'); // Just one digit
          assert.equal(element.validateNumber('1'), true, '1'); // Just one digit
          assert.equal(element.validateNumber(99), true, '99'); // two digits
          assert.equal(element.validateNumber(123456789), true, '123456789'); // A lot digits

          // Some unacceptable numbers
          assert.equal(element.validateNumber(-1.2), false, '-1.2'); // Negative not supported
          assert.equal(element.validateNumber('9,9'), false, '9,9'); // COMMA is not a floating point indicator
        });

        // Test depends on LOCAL US '9,999,999.99' and not European '9.999.999,99'.
        if (decimalSeparator === ',') { // Continental European
          test('B03 - _getMaxNumber()', function() {
            assert.equal(element._getMaxNumber('#'), 9); // Negative not supported
            assert.equal(element._getMaxNumber('######'), 999999);
            assert.equal(element._getMaxNumber('#,#'), 9.9);
            assert.equal(element._getMaxNumber('(###)#,#'), 9999.9);
            assert.equal(element._getMaxNumber('(#.##)#.###,#'), 9999999.9);
          });
        } else {
          test('B03 - _getMaxNumber()', function() {
            assert.equal(element._getMaxNumber('#'), 9); // Negative not supported
            assert.equal(element._getMaxNumber('######'), 999999);
            assert.equal(element._getMaxNumber('#.#'), 9.9);
            assert.equal(element._getMaxNumber('(###)#.#'), 9999.9);
            assert.equal(element._getMaxNumber('(#,##)#,###.#'), 9999999.9);
          });
        }

        // -----------------------------------------------------------------------------------
        // Functionality
        // -----------------------------------------------------------------------------------

        test('C01 - Default layout behavior MIN (0), MAX (99999) values', function() {
          element.setAttribute('format', '#####');
          element.setAttribute('number', 99999);

          assert.equal(element.querySelector('#digit0 #btnUp').disabled, true);
          assert.equal(element.querySelector('#digit1 #btnUp').disabled, true);
          assert.equal(element.querySelector('#digit2 #btnUp').disabled, true);
          assert.equal(element.querySelector('#digit3 #btnUp').disabled, true);
          assert.equal(element.querySelector('#digit4 #btnUp').disabled, true);

          assert.equal(element.querySelector('#digit0 #btnDown').disabled, false);
          assert.equal(element.querySelector('#digit1 #btnDown').disabled, false);
          assert.equal(element.querySelector('#digit2 #btnDown').disabled, false);
          assert.equal(element.querySelector('#digit3 #btnDown').disabled, false);
          assert.equal(element.querySelector('#digit4 #btnDown').disabled, false);

          element.setAttribute('number', 99999);
          assert.equal(element.querySelector('#digit0 #btnUp').disabled, false);
          assert.equal(element.querySelector('#digit1 #btnUp').disabled, false);
          assert.equal(element.querySelector('#digit2 #btnUp').disabled, false);
          assert.equal(element.querySelector('#digit3 #btnUp').disabled, false);
          assert.equal(element.querySelector('#digit4 #btnUp').disabled, false);

          assert.equal(element.querySelector('#digit0 #btnDown').disabled, true);
          assert.equal(element.querySelector('#digit1 #btnDown').disabled, true);
          assert.equal(element.querySelector('#digit2 #btnDown').disabled, true);
          assert.equal(element.querySelector('#digit3 #btnDown').disabled, true);
          assert.equal(element.querySelector('#digit4 #btnDown').disabled, true);
        });

        test('C02 - Default format layout', function() {
          var nodes;

          element.setAttribute('format', '##.###.###,##');
          element.setAttribute('number', 12345678.90);

          nodes = element.querySelector('#digits').childNodes;
          assert.equal(nodes.length, 13); // Including numbers and formatters (,.)

          assert.equal(nodes[0].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[0].digit, '1');

          assert.equal(nodes[1].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[1].digit, '2');

          assert.equal(nodes[2].nodeName, 'DIV');
          assert.equal(nodes[2].textContent, '.');

          assert.equal(nodes[3].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[3].digit, '3');

          assert.equal(nodes[4].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[4].digit, '4');

          assert.equal(nodes[5].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[5].digit, '5');

          assert.equal(nodes[6].nodeName, 'DIV');
          assert.equal(nodes[6].textContent, '.');

          assert.equal(nodes[7].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[7].digit, '6');

          assert.equal(nodes[8].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[8].digit, '7');

          assert.equal(nodes[9].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[9].digit, '8');

          assert.equal(nodes[10].nodeName, 'DIV');
          assert.equal(nodes[10].textContent, ',');

          assert.equal(nodes[11].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[11].digit, '9');

          assert.equal(nodes[12].nodeName, 'KGUI-SINGLE-DIGIT');
          assert.equal(nodes[12].digit, '0');
        });
      });

    </script>
  </body>
</html>
