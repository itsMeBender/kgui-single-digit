<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<!--
`kgui-single-digit` manipulate a single digit

@demo demo/index.html
-->

<dom-module id="kgui-single-digit">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      .digit--button {

      }
      .digit--container {
        width: 3em;
        background-color: var(--primary-background-color, #DDDDDD);
      }
      .digit--number {
        width: 100%;
        font-size: 3.4em;
        text-align: center;
        color: var(--primary-text-color, #22a2f5);
      }
      paper-icon-button {
        margin: 0 auto;
        cursor: pointer;
        width: 100%;
      }
    </style>
    
    <div class="digit--container">
      <paper-icon-button id="btnUp" class="digit--button" on-tap="increase" icon="add-circle-outline"></paper-icon-button>
      <div id="digit" class="digit--number">
        [[digit]]
      </div>
      <paper-icon-button id="btnDown" class="digit--button" on-tap="decrease" icon="remove-circle-outline"></paper-icon-button>
    </div>

  </template>

  <script>
    Polymer({

      // TODO: Add nice animation.
      
      // Decrease the digit by one. Stops at `min` value given.
      decrease: function () {
        if (this.min) {
          if (this.digit > this.min) {
            this.digit -= 1;
            this.$.btnUp.disabled = false;
          } else {
            // Minimum range reached
            this.$.btnDown.disabled = true;
          }
        } else {
          if (this.digit === 0) {
            this.digit = 9;
            // TODO: fire event to inform passing lower border
          } else {
            this.digit -= 1;
          }
        }
      },

      // Increase the digit by one.  Stops at `max` value given.
      increase: function () {
        if (this.max) {
          if  (this.digit < this.max) {
            this.digit += 1;
            this.$.btnDown.disabled = false;
          } else {
            // Maximum range reached
            this.$.btnUp.disabled = true;
          }
        } else {
          if (this.digit === 9) {
            this.digit = 0;
            // TODO: fire event to inform passing upper border
          } else {
            this.digit += 1;
          }          
        }
      },

      is: 'kgui-single-digit',

      properties: {

        // The value to show by default
        digit: {
          type: Number,
          value: 0,
          notify: true,
          observer: "_validateDigit",
        },

        // The maximum value. If none then loop from 9 to 0.
        max: {
          type: Number,
          notify: true,
          observer: "_validateMax",
        },

        // The minimum value. If none then loop from 0 to 9.
        min: {
          type: Number,
          notify: true,
          observer: "_validateMin",
        },

      },

      // Validate if `digit` is a number 0..9, returns actual value.
      _validateDigit: function (_digit, _oldDigit) {
        var retval;

        if(!this.onlyNumber(_digit)) {
          retval = this.digit = _oldDigit; // Reset value to default
        } else {
          retval = _digit;
        }
        if (retval === this.min) {
            this.$.btnDown.disabled = true;
        } else {
            this.$.btnDown.disabled = false;
        }
        if (retval === this.max) {
            this.$.btnUp.disabled = true;
        } else {
            this.$.btnUp.disabled = false;
        }
        return retval;
      },

      // Validate if `max` is a number 0..9, returns actual value.
      _validateMax: function (_max, _oldMax) {
        var retval;

        if(!this.onlyNumber(_max)) {
          retval = this.max = _oldMax; // Reset value to default
        } else {
          retval = _max;
        }
        if (retval === this.digit) {
            this.$.btnUp.disabled = true;
        } else {
            this.$.btnUp.disabled = false;
        }
        return retval;
      },

      // Validate if `min` is a number 0..9, returns actual value.
      _validateMin: function (_min, _oldMin) {
        var retval;

        if(!this.onlyNumber(_min)) {
          retval = this.min = _oldMin; // Reset value to default
        } else {
          retval = _min;
        }
        if (retval === this.digit) {
            this.$.btnDown.disabled = true;
        } else {
            this.$.btnDown.disabled = false;
        }

        return retval;
      },

      // True if validation of `_digit` is a number 0..9
      onlyNumber: function (_digit) {
        var validNumbers = /^[0-9]$/;
        if (!validNumbers.test(_digit)) {
          return false;
        }
        return true;
      },

    });
  </script>
</dom-module>
